#!/bin/bash
set -e
file="/sys/class/backlight/intel_backlight/brightness"
fcurr="/sys/class/backlight/intel_backlight/actual_brightness"
fmax="/sys/class/backlight/intel_backlight/max_brightness"
current=$(cat "$fcurr")
max=$(cat "$fmax")

steps=(0 2 5 9 15 25 40 65 100)

curr=$(bc <<< "scale=10;a=100/$max*$current;scale=0;(a+.5)/1")

case "$1" in
up)
	for (( i=${#steps[@]}-2 ; i >= 0; i-- )); do
		if [ $curr -ge ${steps[i]} ]; then
            new=$(bc <<< "scale=10;a=$max/100*${steps[i+1]};scale=0;(a+.5)/1")
            echo "$new" > "$file"
			break
		fi
	done
	;;
down)
	for (( i=1 ; i < ${#steps[@]} ; i++ )); do
		if [ $curr -le ${steps[i]} ]; then
            new=$(bc <<< "scale=10;a=$max/100*${steps[i-1]};scale=0;(a+.5)/1")
            echo "$new" > "$file"
			break
		fi
	done
	;;
*)
	echo "Usage: brightness [up|down]"
	exit 1
esac

